{{!-- Rise of Arcane and Valor â€” Character Sheet v0.2.0 --}}
<form class="sheet-form" autocomplete="off">

  {{!-- â”€â”€ HEADER â”€â”€ --}}
  <header class="sheet-header">
    <div class="header-portrait">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
    </div>
    <div class="header-fields">
      <div class="header-name">
        <input class="name-input" type="text" name="name" value="{{actor.name}}" placeholder="Character Name"/>
      </div>
      <div class="header-meta">
        <div class="meta-field">
          <label>Race</label>
          <input type="text" name="system.race" value="{{system.race}}" placeholder="Race"/>
        </div>
        <div class="meta-field">
          <label>Class</label>
          <input type="text" name="system.class" value="{{system.class}}" placeholder="Class"/>
        </div>
        <div class="meta-field">
          <label>Level</label>
          <input type="number" name="system.experience.level" value="{{system.experience.level}}" min="1" max="40"/>
        </div>
        <div class="meta-field">
          <label>EXP</label>
          <input type="number" name="system.experience.value" value="{{system.experience.value}}" min="0"/>
        </div>
        <div class="meta-field">
          <label>SP</label>
          <input type="number" name="system.experience.sp" value="{{system.experience.sp}}" min="0"/>
        </div>
      </div>
    </div>
  </header>

  {{!-- â”€â”€ VITALS BAR â”€â”€ --}}
  <section class="vitals-bar">

    <div class="vital-block vital-hp">
      <label class="vital-label">HP</label>
      <div class="vital-controls">
        <button type="button" class="hp-btn vital-btn" data-delta="-1">âˆ’</button>
        <input type="number" name="system.health.value" value="{{system.health.value}}"
               min="0" max="{{system.health.max}}" class="vital-input"/>
        <span class="vital-sep">/</span>
        <span class="vital-max">{{system.health.max}}</span>
        <button type="button" class="hp-btn vital-btn" data-delta="1">+</button>
      </div>
    </div>

    <div class="vital-block vital-mp">
      <label class="vital-label">MP</label>
      <div class="vital-controls">
        <button type="button" class="mp-btn vital-btn" data-delta="-1">âˆ’</button>
        <input type="number" name="system.magic.value" value="{{system.magic.value}}"
               min="0" max="{{system.magic.max}}" class="vital-input"/>
        <span class="vital-sep">/</span>
        <span class="vital-max">{{system.magic.max}}</span>
        <button type="button" class="mp-btn vital-btn" data-delta="1">+</button>
      </div>
    </div>

    <div class="vital-block vital-luck">
      <label class="vital-label">Luck</label>
      <div class="vital-controls">
        <span class="luck-value">{{system.attributes.luck.value}}</span>
        <button type="button" class="luck-roll vital-btn" title="Roll d6 for session Luck">ðŸŽ²</button>
      </div>
    </div>

    <div class="vital-block">
      <label class="vital-label">Food</label>
      <input type="number" name="system.food.value" value="{{system.food.value}}"
             min="0" max="{{system.food.max}}" class="vital-input small"/>
    </div>

    <div class="vital-block">
      <label class="vital-label">Gold</label>
      <input type="number" name="system.gold.value" value="{{system.gold.value}}"
             min="0" class="vital-input small"/>
    </div>

  </section>

  {{!-- â”€â”€ ATTRIBUTES â”€â”€ --}}
  <section class="attributes-section">
    <h2 class="section-title">Attributes</h2>
    <div class="attributes-grid">

      {{!-- Might --}}
      <div class="attribute-box">
        <label class="attribute-label attribute-roll" data-attribute="might" title="Roll Might check">Might</label>
        <input type="number" name="system.attributes.might.value"
               value="{{system.attributes.might.value}}" min="1" max="5" class="attribute-value"/>
        <div class="attribute-dots">
          {{#times 5}}<span class="dot {{#if (lte (add this 1) ../system.attributes.might.value)}}filled{{/if}}"></span>{{/times}}
        </div>
      </div>

      {{!-- Agility --}}
      <div class="attribute-box">
        <label class="attribute-label attribute-roll" data-attribute="agility" title="Roll Agility check">Agility</label>
        <input type="number" name="system.attributes.agility.value"
               value="{{system.attributes.agility.value}}" min="1" max="5" class="attribute-value"/>
        <div class="attribute-dots">
          {{#times 5}}<span class="dot {{#if (lte (add this 1) ../system.attributes.agility.value)}}filled{{/if}}"></span>{{/times}}
        </div>
      </div>

      {{!-- Endurance --}}
      <div class="attribute-box">
        <label class="attribute-label attribute-roll" data-attribute="endurance" title="Roll Endurance check">Endurance</label>
        <input type="number" name="system.attributes.endurance.value"
               value="{{system.attributes.endurance.value}}" min="1" max="5" class="attribute-value"/>
        <div class="attribute-dots">
          {{#times 5}}<span class="dot {{#if (lte (add this 1) ../system.attributes.endurance.value)}}filled{{/if}}"></span>{{/times}}
        </div>
      </div>

      {{!-- Intellect --}}
      <div class="attribute-box">
        <label class="attribute-label attribute-roll" data-attribute="intellect" title="Roll Intellect check">Intellect</label>
        <input type="number" name="system.attributes.intellect.value"
               value="{{system.attributes.intellect.value}}" min="1" max="5" class="attribute-value"/>
        <div class="attribute-dots">
          {{#times 5}}<span class="dot {{#if (lte (add this 1) ../system.attributes.intellect.value)}}filled{{/if}}"></span>{{/times}}
        </div>
      </div>

      {{!-- Personality --}}
      <div class="attribute-box">
        <label class="attribute-label attribute-roll" data-attribute="personality" title="Roll Personality check">Personality</label>
        <input type="number" name="system.attributes.personality.value"
               value="{{system.attributes.personality.value}}" min="1" max="5" class="attribute-value"/>
        <div class="attribute-dots">
          {{#times 5}}<span class="dot {{#if (lte (add this 1) ../system.attributes.personality.value)}}filled{{/if}}"></span>{{/times}}
        </div>
      </div>

    </div>
  </section>

  {{!-- â”€â”€ TABS â”€â”€ --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="skills">Skills</a>
    <a class="item" data-tab="specialties">Specialties</a>
    <a class="item" data-tab="gear">Gear &amp; Items</a>
    <a class="item" data-tab="bio">Biography</a>
  </nav>

  <section class="sheet-body">

    {{!-- â”€â”€ TAB: SKILLS â”€â”€ --}}
    <div class="tab" data-tab="skills">
      <div class="skills-columns">

        <div class="skill-group">
          <h3 class="skill-group-title">General</h3>
          {{#each system.skills.misc as |skill key|}}
          <div class="skill-row">
            <span class="skill-name skill-roll" data-group="misc" data-skill="{{key}}"
                  title="Click to roll {{skill.label}}">{{skill.label}}</span>
            <input type="number" name="system.skills.misc.{{key}}.level"
                   value="{{skill.level}}" min="0" max="9" class="skill-level"/>
            <select name="system.skills.misc.{{key}}.tier"
                    class="skill-tier-select tier-{{skill.tier}}{{#if skill.tierMismatch}} tier-mismatch{{/if}}"
                    title="{{#if skill.tierMismatch}}Suggested tier based on level: {{tierLabel skill.suggestedTier}}{{else}}Tier matches level{{/if}}">
              <option value="novice"      {{#if (eq skill.tier "novice")}}selected{{/if}}>Novice</option>
              <option value="expert"      {{#if (eq skill.tier "expert")}}selected{{/if}}>Expert</option>
              <option value="master"      {{#if (eq skill.tier "master")}}selected{{/if}}>Master</option>
              <option value="grandmaster" {{#if (eq skill.tier "grandmaster")}}selected{{/if}}>Grand Master</option>
            </select>
          </div>
          {{/each}}
        </div>

        <div class="skill-group">
          <h3 class="skill-group-title">Weapons</h3>
          {{#each system.skills.weapon as |skill key|}}
          <div class="skill-row">
            <span class="skill-name skill-roll" data-group="weapon" data-skill="{{key}}"
                  title="Click to roll {{skill.label}}">{{skill.label}}</span>
            <input type="number" name="system.skills.weapon.{{key}}.level"
                   value="{{skill.level}}" min="0" max="9" class="skill-level"/>
            <select name="system.skills.weapon.{{key}}.tier"
                    class="skill-tier-select tier-{{skill.tier}}{{#if skill.tierMismatch}} tier-mismatch{{/if}}"
                    title="{{#if skill.tierMismatch}}Suggested tier based on level: {{tierLabel skill.suggestedTier}}{{else}}Tier matches level{{/if}}">
              <option value="novice"      {{#if (eq skill.tier "novice")}}selected{{/if}}>Novice</option>
              <option value="expert"      {{#if (eq skill.tier "expert")}}selected{{/if}}>Expert</option>
              <option value="master"      {{#if (eq skill.tier "master")}}selected{{/if}}>Master</option>
              <option value="grandmaster" {{#if (eq skill.tier "grandmaster")}}selected{{/if}}>Grand Master</option>
            </select>
          </div>
          {{/each}}
        </div>

        <div class="skill-group">
          <h3 class="skill-group-title">Magic</h3>
          {{#each system.skills.magic as |skill key|}}
          <div class="skill-row">
            <span class="skill-name skill-roll" data-group="magic" data-skill="{{key}}"
                  title="Click to roll {{skill.label}}">{{skill.label}}</span>
            <input type="number" name="system.skills.magic.{{key}}.level"
                   value="{{skill.level}}" min="0" max="9" class="skill-level"/>
            <select name="system.skills.magic.{{key}}.tier" class="skill-tier-select tier-{{skill.tier}}">
              <option value="novice"      {{#if (eq skill.tier "novice")}}selected{{/if}}>Novice</option>
              <option value="expert"      {{#if (eq skill.tier "expert")}}selected{{/if}}>Expert</option>
              <option value="master"      {{#if (eq skill.tier "master")}}selected{{/if}}>Master</option>
              <option value="grandmaster" {{#if (eq skill.tier "grandmaster")}}selected{{/if}}>Grand Master</option>
            </select>
          </div>
          {{/each}}
        </div>

      </div>
    </div>

    {{!-- â”€â”€ TAB: SPECIALTIES â”€â”€ --}}
    <div class="tab" data-tab="specialties">
      <div class="specialties-grid">

        {{#each system.specialties as |spec key|}}
        <div class="spec-row">
          <span class="spec-name" data-tooltip="{{lookup @root.specDescriptions key}}">
            {{spec.label}}
            <span class="spec-hint">?</span>
          </span>
          <input type="number" name="system.specialties.{{key}}.level"
                 value="{{spec.level}}" min="0" max="9" class="skill-level"/>
          <select name="system.specialties.{{key}}.tier"
                  class="skill-tier-select tier-{{spec.tier}}{{#if spec.tierMismatch}} tier-mismatch{{/if}}"
                  title="{{#if spec.tierMismatch}}Suggested tier based on level: {{tierLabel spec.suggestedTier}}{{else}}Tier matches level{{/if}}">
            <option value="novice"      {{#if (eq spec.tier "novice")}}selected{{/if}}>Novice</option>
            <option value="expert"      {{#if (eq spec.tier "expert")}}selected{{/if}}>Expert</option>
            <option value="master"      {{#if (eq spec.tier "master")}}selected{{/if}}>Master</option>
            <option value="grandmaster" {{#if (eq spec.tier "grandmaster")}}selected{{/if}}>Grand Master</option>
          </select>
        </div>
        {{/each}}

      </div>
      <p class="spec-tip">ðŸ’¡ Hover over a specialty name to see its description.</p>
    </div>

    {{!-- â”€â”€ TAB: GEAR & ITEMS â”€â”€ --}}
    <div class="tab" data-tab="gear">

      {{!-- Equipped slots --}}
      <div class="gear-slots">
        <h3 class="skill-group-title">Equipped Slots</h3>
        <div class="gear-slot-grid">
          <div class="gear-slot"><label>Right Arm</label>
            <input type="text" name="system.gear.rightArm" value="{{system.gear.rightArm}}" placeholder="Empty"/></div>
          <div class="gear-slot"><label>Left Arm</label>
            <input type="text" name="system.gear.leftArm" value="{{system.gear.leftArm}}" placeholder="Empty"/></div>
          <div class="gear-slot"><label>Head</label>
            <input type="text" name="system.gear.head" value="{{system.gear.head}}" placeholder="Empty"/></div>
          <div class="gear-slot"><label>Torso</label>
            <input type="text" name="system.gear.torso" value="{{system.gear.torso}}" placeholder="Empty"/></div>
          <div class="gear-slot"><label>Legs</label>
            <input type="text" name="system.gear.legs" value="{{system.gear.legs}}" placeholder="Empty"/></div>
          <div class="gear-slot"><label>Necklace</label>
            <input type="text" name="system.gear.necklace" value="{{system.gear.necklace}}" placeholder="Empty"/></div>
          <div class="gear-slot"><label>Rings</label>
            <input type="text" name="system.gear.rings" value="{{system.gear.rings}}" placeholder="Empty"/></div>
        </div>
      </div>

      {{!-- Inventory by category --}}
      <div class="inventory">

        {{!-- Weapons --}}
        <div class="inv-category">
          <div class="inv-category-header">
            <h3 class="skill-group-title">Weapons</h3>
            <a class="item-create inv-add" data-type="weapon" title="Add Weapon">+ Add</a>
          </div>
          {{#each actor.items as |item|}}
          {{#if (eq item.type "weapon")}}
          <div class="item-row" data-item-id="{{item.id}}">
            <img class="item-img" src="{{item.img}}" title="{{item.name}}"/>
            <span class="item-name">{{item.name}}</span>
            <span class="item-detail">
              {{#if item.system.broken}}
                <span class="item-broken">BROKEN</span>
              {{else}}
                DMG: {{item.system.damagePoints}}/5
              {{/if}}
            </span>
            <span class="item-property">{{item.system.property}}</span>
            <div class="item-controls">
              <a class="item-equip" title="{{#if item.system.equipped}}Unequip{{else}}Equip{{/if}}">
                {{#if item.system.equipped}}âš”{{else}}â—‹{{/if}}
              </a>
              <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
            </div>
          </div>
          {{/if}}
          {{/each}}
        </div>

        {{!-- Armor --}}
        <div class="inv-category">
          <div class="inv-category-header">
            <h3 class="skill-group-title">Armor</h3>
            <a class="item-create inv-add" data-type="armor" title="Add Armor">+ Add</a>
          </div>
          {{#each actor.items as |item|}}
          {{#if (eq item.type "armor")}}
          <div class="item-row" data-item-id="{{item.id}}">
            <img class="item-img" src="{{item.img}}" title="{{item.name}}"/>
            <span class="item-name">{{item.name}}</span>
            <span class="item-detail">
              {{#if item.system.broken}}
                <span class="item-broken">BROKEN</span>
              {{else}}
                DMG: {{item.system.damagePoints}}/{{item.system.maxDamagePoints}}
              {{/if}}
            </span>
            <span class="item-property">{{item.system.armorType}}</span>
            <div class="item-controls">
              <a class="item-equip" title="{{#if item.system.equipped}}Unequip{{else}}Equip{{/if}}">
                {{#if item.system.equipped}}ðŸ›¡{{else}}â—‹{{/if}}
              </a>
              <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
            </div>
          </div>
          {{/if}}
          {{/each}}
        </div>

        {{!-- Spells --}}
        <div class="inv-category">
          <div class="inv-category-header">
            <h3 class="skill-group-title">Spells</h3>
            <a class="item-create inv-add" data-type="spell" title="Add Spell">+ Add</a>
          </div>
          {{#each actor.items as |item|}}
          {{#if (eq item.type "spell")}}
          <div class="item-row" data-item-id="{{item.id}}">
            <img class="item-img" src="{{item.img}}" title="{{item.name}}"/>
            <span class="item-name">{{item.name}}</span>
            <span class="item-detail">{{item.system.school}} Â· {{item.system.mpCost}} MP</span>
            <span class="item-property tier-{{item.system.tier}}">{{tierLabel item.system.tier}}</span>
            <div class="item-controls">
              <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
            </div>
          </div>
          {{/if}}
          {{/each}}
        </div>

        {{!-- Relics --}}
        <div class="inv-category">
          <div class="inv-category-header">
            <h3 class="skill-group-title">Relics &amp; Artifacts</h3>
            <a class="item-create inv-add" data-type="relic" title="Add Relic">+ Add</a>
          </div>
          {{#each actor.items as |item|}}
          {{#if (eq item.type "relic")}}
          <div class="item-row" data-item-id="{{item.id}}">
            <img class="item-img" src="{{item.img}}" title="{{item.name}}"/>
            <span class="item-name">
              {{#if item.system.identified}}
                {{item.name}}
              {{else}}
                <em>Unidentified Relic</em>
              {{/if}}
            </span>
            <span class="item-detail rarity-{{item.system.rarity}}">{{capitalize item.system.rarity}}</span>
            <div class="item-controls">
              <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
            </div>
          </div>
          {{/if}}
          {{/each}}
        </div>

      </div>
    </div>

    {{!-- â”€â”€ TAB: BIOGRAPHY â”€â”€ --}}
    <div class="tab" data-tab="bio">
      <div class="bio-section">
        <label class="bio-label">Character Biography</label>
        <div class="bio-editor">
          <textarea name="system.biography" class="bio-textarea"
                    placeholder="Write your character's backstory here...">{{system.biography}}</textarea>
        </div>
      </div>
    </div>

  </section>
</form>
